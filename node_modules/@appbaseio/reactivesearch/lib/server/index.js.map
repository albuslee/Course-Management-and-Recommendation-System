{"version":3,"sources":["../../src/server/index.js"],"names":["initReactivesearch","componentsWithHighlightQuery","componentsWithOptions","componentsWithoutFilters","resultComponents","getValue","state","id","defaultValue","parseValue","value","component","source","getQuery","includes","type","defaultQuery","currentValue","customQuery","componentCollection","searchState","settings","Promise","resolve","reject","credentials","url","trim","config","app","appbaseRef","components","selectedValues","queryList","queryLog","queryOptions","dependencyTree","finalQuery","orderOfQueries","hits","aggregations","forEach","componentId","isInternalComponentPresent","isResultComponent","internalComponent","label","filterLabel","defaultSelected","showFilter","undefined","URLParams","options","generateQueryOptions","highlightQuery","highlight","Object","keys","length","aggs","size","otherQueryOptions","mainQueryOptions","from","react","query","queryObj","validOptions","some","item","match_all","currentQuery","preference","msearch","body","on","res","index","response","responses","total","time","took","err"],"mappings":"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","file":"index.js","sourcesContent":["import Appbase from 'appbase-js';\n\nimport valueReducer from '@appbaseio/reactivecore/lib/reducers/valueReducer';\nimport queryReducer from '@appbaseio/reactivecore/lib/reducers/queryReducer';\nimport queryOptionsReducer from '@appbaseio/reactivecore/lib/reducers/queryOptionsReducer';\nimport dependencyTreeReducer from '@appbaseio/reactivecore/lib/reducers/dependencyTreeReducer';\nimport { buildQuery, pushToAndClause } from '@appbaseio/reactivecore/lib/utils/helper';\n\nconst componentsWithHighlightQuery = [\n\t'DataSearch',\n\t'CategorySearch',\n];\n\nconst componentsWithOptions = [\n\t'ResultList',\n\t'ResultCard',\n\t'ReactiveList',\n\t'ReactiveMap',\n\t'SingleList',\n\t'MultiList',\n\t'TagCloud',\n\t...componentsWithHighlightQuery,\n];\n\nconst componentsWithoutFilters = [\n\t'NumberBox',\n\t'RangeSlider',\n\t'DynamicRangeSlider',\n\t'RangeInput',\n\t'RatingsFilter',\n];\n\nconst resultComponents = ['ResultCard', 'ResultList', 'ReactiveList', 'ReactiveMap'];\n\nfunction getValue(state, id, defaultValue) {\n\treturn state ? state[id] : defaultValue;\n}\n\nfunction parseValue(value, component) {\n\tif (component.source && component.source.parseValue) {\n\t\treturn component.source.parseValue(value, component);\n\t}\n\treturn value;\n}\n\nfunction getQuery(component, value) {\n\t// get default query of result components\n\tif (resultComponents.includes(component.type)) {\n\t\treturn component.defaultQuery ? component.defaultQuery() : {};\n\t}\n\n\t// get custom or default query of sensor components\n\tconst currentValue = parseValue(value, component);\n\tif (component.customQuery) {\n\t\treturn component.customQuery(currentValue, component);\n\t}\n\treturn component.source.defaultQuery\n\t\t? component.source.defaultQuery(currentValue, component)\n\t\t: {};\n}\n\nexport default function initReactivesearch(componentCollection, searchState, settings) {\n\treturn new Promise((resolve, reject) => {\n\t\tconst credentials = settings.url && settings.url.trim() !== '' && !settings.credentials\n\t\t\t? null\n\t\t\t: settings.credentials;\n\t\tconst config = {\n\t\t\turl: settings.url && settings.url.trim() !== '' ? settings.url : 'https://scalr.api.appbase.io',\n\t\t\tapp: settings.app,\n\t\t\tcredentials,\n\t\t\ttype: settings.type ? settings.type : '*',\n\t\t};\n\t\tconst appbaseRef = new Appbase(config);\n\n\t\tlet components = [];\n\t\tlet selectedValues = {};\n\t\tlet queryList = {};\n\t\tlet queryLog = {};\n\t\tlet queryOptions = {};\n\t\tlet dependencyTree = {};\n\t\tlet finalQuery = [];\n\t\tlet orderOfQueries = [];\n\t\tlet hits = {};\n\t\tlet aggregations = {};\n\t\tlet state = {};\n\n\t\tcomponentCollection.forEach((component) => {\n\t\t\tcomponents = [...components, component.componentId];\n\n\t\t\tlet isInternalComponentPresent = false;\n\t\t\tconst isResultComponent = resultComponents.includes(component.type);\n\t\t\tconst internalComponent = `${component.componentId}__internal`;\n\t\t\tconst label = component.filterLabel || component.componentId;\n\t\t\tconst value = getValue(searchState, label, component.defaultSelected);\n\n\t\t\t// [1] set selected values\n\t\t\tlet showFilter = component.showFilter !== undefined ? component.showFilter : true;\n\t\t\tif (componentsWithoutFilters.includes(component.type)) {\n\t\t\t\tshowFilter = false;\n\t\t\t}\n\t\t\tselectedValues = valueReducer(selectedValues, {\n\t\t\t\ttype: 'SET_VALUE',\n\t\t\t\tcomponent: component.componentId,\n\t\t\t\tlabel,\n\t\t\t\tvalue,\n\t\t\t\tshowFilter,\n\t\t\t\tURLParams: component.URLParams || false,\n\t\t\t});\n\n\t\t\t// [2] set query options - main component query (valid for result components)\n\t\t\tif (componentsWithOptions.includes(component.type)) {\n\t\t\t\tconst options = component.source.generateQueryOptions\n\t\t\t\t\t? component.source.generateQueryOptions(component)\n\t\t\t\t\t: null;\n\t\t\t\tlet highlightQuery = {};\n\n\t\t\t\tif (\n\t\t\t\t\tcomponentsWithHighlightQuery.includes(component.type)\n\t\t\t\t\t&& component.highlight\n\t\t\t\t) {\n\t\t\t\t\thighlightQuery = component.source.highlightQuery(component);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\t(options && Object.keys(options).length)\n\t\t\t\t\t|| (highlightQuery && Object.keys(highlightQuery).length)\n\t\t\t\t) {\n\t\t\t\t\t// eslint-disable-next-line\n\t\t\t\t\tlet { aggs, size, ...otherQueryOptions } = options || {};\n\n\t\t\t\t\tif (aggs && Object.keys(aggs).length) {\n\t\t\t\t\t\tisInternalComponentPresent = true;\n\n\t\t\t\t\t\t// query should be applied on the internal component\n\t\t\t\t\t\t// to enable feeding the data to parent component\n\t\t\t\t\t\tqueryOptions = queryOptionsReducer(queryOptions, {\n\t\t\t\t\t\t\ttype: 'SET_QUERY_OPTIONS',\n\t\t\t\t\t\t\tcomponent: internalComponent,\n\t\t\t\t\t\t\toptions: { aggs, size: size || 100 },\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// sort, highlight, size, from - query should be applied on the main component\n\t\t\t\t\tif (\n\t\t\t\t\t\t(otherQueryOptions && Object.keys(otherQueryOptions).length)\n\t\t\t\t\t\t|| (highlightQuery && Object.keys(highlightQuery).length)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!otherQueryOptions) otherQueryOptions = {};\n\t\t\t\t\t\tif (!highlightQuery) highlightQuery = {};\n\n\t\t\t\t\t\tlet mainQueryOptions = { ...otherQueryOptions, ...highlightQuery, size };\n\t\t\t\t\t\tif (isInternalComponentPresent) {\n\t\t\t\t\t\t\tmainQueryOptions = { ...otherQueryOptions, ...highlightQuery };\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (isResultComponent) {\n\t\t\t\t\t\t\tmainQueryOptions = {\n\t\t\t\t\t\t\t\tfrom: 0,\n\t\t\t\t\t\t\t\tsize: component.size || 10,\n\t\t\t\t\t\t\t\t...mainQueryOptions,\n\t\t\t\t\t\t\t\t...highlightQuery,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqueryOptions = queryOptionsReducer(queryOptions, {\n\t\t\t\t\t\t\ttype: 'SET_QUERY_OPTIONS',\n\t\t\t\t\t\t\tcomponent: component.componentId,\n\t\t\t\t\t\t\toptions: { ...mainQueryOptions },\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// [3] set dependency tree\n\t\t\tif (component.react || isInternalComponentPresent || isResultComponent) {\n\t\t\t\tlet { react } = component;\n\t\t\t\tif (isInternalComponentPresent || isResultComponent) {\n\t\t\t\t\treact = pushToAndClause(react, internalComponent);\n\t\t\t\t}\n\n\t\t\t\tdependencyTree = dependencyTreeReducer(dependencyTree, {\n\t\t\t\t\ttype: 'WATCH_COMPONENT',\n\t\t\t\t\tcomponent: component.componentId,\n\t\t\t\t\treact,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// [4] set query list\n\t\t\tif (isResultComponent) {\n\t\t\t\tconst { query } = getQuery(component);\n\t\t\t\tqueryList = queryReducer(queryList, {\n\t\t\t\t\ttype: 'SET_QUERY',\n\t\t\t\t\tcomponent: internalComponent,\n\t\t\t\t\tquery,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tqueryList = queryReducer(queryList, {\n\t\t\t\t\ttype: 'SET_QUERY',\n\t\t\t\t\tcomponent: component.componentId,\n\t\t\t\t\tquery: getQuery(component, value),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// [5] Generate finalQuery for search\n\t\tcomponentCollection.forEach((component) => {\n\t\t\t// eslint-disable-next-line\n\t\t\tlet { queryObj, options } = buildQuery(\n\t\t\t\tcomponent.componentId,\n\t\t\t\tdependencyTree,\n\t\t\t\tqueryList,\n\t\t\t\tqueryOptions,\n\t\t\t);\n\n\t\t\tconst validOptions = ['aggs', 'from', 'sort'];\n\t\t\t// check if query or options are valid - non-empty\n\t\t\tif (\n\t\t\t\t(queryObj && !!Object.keys(queryObj).length)\n\t\t\t\t|| (options && (\n\t\t\t\t\tObject.keys(options).some(item => validOptions.includes(item)))\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tif (!queryObj || (queryObj && !Object.keys(queryObj).length)) {\n\t\t\t\t\tqueryObj = { match_all: {} };\n\t\t\t\t}\n\n\t\t\t\torderOfQueries = [...orderOfQueries, component.componentId];\n\n\t\t\t\tconst currentQuery = {\n\t\t\t\t\tquery: { ...queryObj },\n\t\t\t\t\t...options,\n\t\t\t\t\t...queryOptions[component.componentId],\n\t\t\t\t};\n\n\t\t\t\tqueryLog = {\n\t\t\t\t\t...queryLog,\n\t\t\t\t\t[component.componentId]: currentQuery,\n\t\t\t\t};\n\n\t\t\t\tfinalQuery = [\n\t\t\t\t\t...finalQuery,\n\t\t\t\t\t{\n\t\t\t\t\t\tpreference: component.componentId,\n\t\t\t\t\t},\n\t\t\t\t\tcurrentQuery,\n\t\t\t\t];\n\t\t\t}\n\t\t});\n\n\t\tstate = {\n\t\t\tcomponents,\n\t\t\tdependencyTree,\n\t\t\tqueryList,\n\t\t\tqueryOptions,\n\t\t\tselectedValues,\n\t\t\tqueryLog,\n\t\t};\n\n\t\tappbaseRef.msearch({\n\t\t\ttype: config.type === '*' ? '' : config.type,\n\t\t\tbody: finalQuery,\n\t\t})\n\t\t\t.on('data', (res) => {\n\t\t\t\torderOfQueries.forEach((component, index) => {\n\t\t\t\t\tconst response = res.responses[index];\n\t\t\t\t\tif (response.aggregations) {\n\t\t\t\t\t\taggregations = {\n\t\t\t\t\t\t\t...aggregations,\n\t\t\t\t\t\t\t[component]: response.aggregations,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\thits = {\n\t\t\t\t\t\t...hits,\n\t\t\t\t\t\t[component]: {\n\t\t\t\t\t\t\thits: response.hits.hits,\n\t\t\t\t\t\t\ttotal: response.hits.total,\n\t\t\t\t\t\t\ttime: response.took,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t\tstate = {\n\t\t\t\t\t...state,\n\t\t\t\t\thits,\n\t\t\t\t\taggregations,\n\t\t\t\t};\n\t\t\t\tresolve(state);\n\t\t\t})\n\t\t\t.on('error', err => reject(err));\n\t});\n}\n"]}
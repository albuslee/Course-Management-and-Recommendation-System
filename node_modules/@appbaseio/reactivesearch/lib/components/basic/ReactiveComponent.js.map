{"version":3,"sources":["../../../src/components/basic/ReactiveComponent.js"],"names":["ReactiveComponent","props","internalComponent","defaultQuery","setQueryListener","componentId","onQueryChange","setQuery","obj","updateQuery","label","filterLabel","showFilter","URLParams","componentWillMount","addComponent","setReact","query","queryOptions","setQueryOptions","componentWillReceiveProps","nextProps","onAllData","hits","aggregations","componentWillUnmount","removeComponent","render","children","addFn","watchFn","watchComponent","removeFn","queryOptionsFn","updateFn","rest","childrenWithProps","Children","map","cloneElement","child","e","react","newReact","and","defaultProps","propTypes","funcRequired","selectedValues","data","selectedValue","stringRequired","func","string","bool","mapStateToProps","state","value","mapDispatchtoProps","dispatch","component","execute","beforeQueryChange","updateQueryObject"],"mappings":"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","file":"ReactiveComponent.js","sourcesContent":["import React, { Component } from 'react';\n\nimport {\n\taddComponent,\n\tremoveComponent,\n\twatchComponent,\n\tupdateQuery,\n\tsetQueryOptions,\n\tsetQueryListener,\n} from '@appbaseio/reactivecore/lib/actions';\nimport {\n\tpushToAndClause,\n\tparseHits,\n\tisEqual,\n} from '@appbaseio/reactivecore/lib/utils/helper';\nimport types from '@appbaseio/reactivecore/lib/utils/types';\n\nimport { connect } from '../../utils';\n\nclass ReactiveComponent extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.internalComponent = null;\n\t\tthis.defaultQuery = null;\n\t\tprops.setQueryListener(props.componentId, props.onQueryChange, null);\n\n\t\tthis.setQuery = (obj) => {\n\t\t\tthis.props.updateQuery({\n\t\t\t\t...obj,\n\t\t\t\tcomponentId: props.componentId,\n\t\t\t\tlabel: props.filterLabel,\n\t\t\t\tshowFilter: props.showFilter,\n\t\t\t\tURLParams: props.URLParams,\n\t\t\t});\n\t\t};\n\n\t\tif (props.defaultQuery) {\n\t\t\tthis.internalComponent = `${props.componentId}__internal`;\n\t\t}\n\t}\n\n\tcomponentWillMount() {\n\t\tthis.props.addComponent(this.props.componentId);\n\t\tif (this.internalComponent) {\n\t\t\tthis.props.addComponent(this.internalComponent);\n\t\t}\n\n\t\tthis.setReact(this.props);\n\n\t\t// set query for internal component\n\t\tif (this.internalComponent && this.props.defaultQuery) {\n\t\t\tthis.defaultQuery = this.props.defaultQuery();\n\t\t\tconst { query, ...queryOptions } = this.defaultQuery || {};\n\n\t\t\tif (queryOptions) {\n\t\t\t\tthis.props.setQueryOptions(this.internalComponent, queryOptions, false);\n\t\t\t}\n\n\t\t\tthis.props.updateQuery({\n\t\t\t\tcomponentId: this.internalComponent,\n\t\t\t\tquery: query || null,\n\t\t\t});\n\t\t}\n\t}\n\n\tcomponentWillReceiveProps(nextProps) {\n\t\tif (\n\t\t\tnextProps.onAllData\n\t\t\t&& (\n\t\t\t\t!isEqual(nextProps.hits, this.props.hits)\n\t\t\t\t|| !isEqual(nextProps.aggregations, this.props.aggregations)\n\t\t\t)\n\t\t) {\n\t\t\tnextProps.onAllData(parseHits(nextProps.hits), nextProps.aggregations);\n\t\t}\n\n\t\tif (\n\t\t\tnextProps.defaultQuery\n\t\t\t&& !isEqual(\n\t\t\t\tnextProps.defaultQuery(),\n\t\t\t\tthis.defaultQuery,\n\t\t\t)\n\t\t) {\n\t\t\tthis.defaultQuery = nextProps.defaultQuery();\n\t\t\tconst { query, ...queryOptions } = this.defaultQuery || {};\n\n\t\t\tif (queryOptions) {\n\t\t\t\tnextProps.setQueryOptions(this.internalComponent, queryOptions, false);\n\t\t\t}\n\n\t\t\tnextProps.updateQuery({\n\t\t\t\tcomponentId: this.internalComponent,\n\t\t\t\tquery: query || null,\n\t\t\t});\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.props.removeComponent(this.props.componentId);\n\n\t\tif (this.internalComponent) {\n\t\t\tthis.props.removeComponent(this.internalComponent);\n\t\t}\n\t}\n\n\tsetReact = (props) => {\n\t\tconst { react } = props;\n\n\t\tif (react) {\n\t\t\tif (this.internalComponent) {\n\t\t\t\tconst newReact = pushToAndClause(react, this.internalComponent);\n\t\t\t\tprops.watchComponent(props.componentId, newReact);\n\t\t\t} else {\n\t\t\t\tprops.watchComponent(props.componentId, react);\n\t\t\t}\n\t\t} else if (this.internalComponent) {\n\t\t\tprops.watchComponent(props.componentId, { and: this.internalComponent });\n\t\t}\n\t};\n\n\trender() {\n\t\tconst {\n\t\t\tchildren,\n\t\t\taddComponent: addFn,\n\t\t\twatchComponent: watchFn,\n\t\t\tremoveComponent: removeFn,\n\t\t\tsetQueryOptions: queryOptionsFn,\n\t\t\tupdateQuery: updateFn,\n\t\t\t...rest\n\t\t} = this.props;\n\n\t\ttry {\n\t\t\tconst childrenWithProps = React.Children.map(children, child =>\n\t\t\t\tReact.cloneElement(child, { ...rest, setQuery: this.setQuery }));\n\t\t\treturn <div>{childrenWithProps}</div>;\n\t\t} catch (e) {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\nReactiveComponent.defaultProps = {\n\tshowFilter: true,\n\tURLParams: false,\n};\n\nReactiveComponent.propTypes = {\n\taddComponent: types.funcRequired,\n\tremoveComponent: types.funcRequired,\n\tsetQueryListener: types.funcRequired,\n\tsetQueryOptions: types.funcRequired,\n\tupdateQuery: types.funcRequired,\n\twatchComponent: types.funcRequired,\n\taggregations: types.selectedValues,\n\thits: types.data,\n\tselectedValue: types.selectedValue,\n\t// component props\n\tchildren: types.children,\n\tcomponentId: types.stringRequired,\n\tdefaultQuery: types.func,\n\tfilterLabel: types.string,\n\tonQueryChange: types.func,\n\treact: types.react,\n\tshowFilter: types.bool,\n\tURLParams: types.bool,\n\tonAllData: types.func,\n};\n\nconst mapStateToProps = (state, props) => ({\n\taggregations: (state.aggregations[props.componentId]\n\t\t&& state.aggregations[props.componentId]) || null,\n\thits: (state.hits[props.componentId]\n\t\t&& state.hits[props.componentId].hits) || [],\n\tselectedValue: (state.selectedValues[props.componentId]\n\t\t&& state.selectedValues[props.componentId].value) || null,\n});\n\nconst mapDispatchtoProps = dispatch => ({\n\taddComponent: component => dispatch(addComponent(component)),\n\tremoveComponent: component => dispatch(removeComponent(component)),\n\tsetQueryOptions: (component, props, execute) => dispatch(setQueryOptions(\n\t\tcomponent,\n\t\tprops,\n\t\texecute,\n\t)),\n\tsetQueryListener: (component, onQueryChange, beforeQueryChange) =>\n\t\tdispatch(setQueryListener(component, onQueryChange, beforeQueryChange)),\n\tupdateQuery: updateQueryObject => dispatch(updateQuery(updateQueryObject)),\n\twatchComponent: (component, react) => dispatch(watchComponent(component, react)),\n});\n\nexport default connect(mapStateToProps, mapDispatchtoProps)(ReactiveComponent);\n"]}
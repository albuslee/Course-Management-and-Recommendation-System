{"version":3,"sources":["../../../src/components/range/MultiDropdownRange.js"],"names":["MultiDropdownRange","props","state","currentValue","selectedValues","type","locked","setQueryListener","componentId","onQueryChange","componentWillMount","addComponent","setReact","selectedValue","selectItem","defaultSelected","componentWillReceiveProps","nextProps","react","dataField","updateQuery","componentWillUnmount","removeComponent","watchComponent","render","style","className","title","innerClass","data","placeholder","themePreset","parseValue","value","filter","includes","item","label","defaultQuery","values","generateRangeQuery","items","length","map","range","gte","start","lte","end","boost","query","bool","should","minimum_should_match","isDefaultValue","beforeValueChange","forEach","del","performUpdate","setState","onValueChange","customQuery","filterLabel","showFilter","URLParams","propTypes","funcRequired","func","string","stringRequired","stringArray","defaultProps","mapStateToProps","config","mapDispatchtoProps","dispatch","component","updateQueryObject","beforeQueryChange"],"mappings":"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","file":"MultiDropdownRange.js","sourcesContent":["import React, { Component } from 'react';\n\nimport {\n\taddComponent,\n\tremoveComponent,\n\twatchComponent,\n\tupdateQuery,\n\tsetQueryListener,\n} from '@appbaseio/reactivecore/lib/actions';\nimport {\n\tisEqual,\n\tcheckValueChange,\n\tcheckPropChange,\n\tgetClassName,\n} from '@appbaseio/reactivecore/lib/utils/helper';\n\nimport types from '@appbaseio/reactivecore/lib/utils/types';\n\nimport Title from '../../styles/Title';\nimport Container from '../../styles/Container';\nimport Dropdown from '../shared/Dropdown';\nimport { connect } from '../../utils';\n\nclass MultiDropdownRange extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tcurrentValue: [],\n\t\t};\n\n\t\t// selectedValues hold the selected items as keys for O(1) complexity\n\t\tthis.selectedValues = {};\n\t\tthis.type = 'range';\n\t\tthis.locked = false;\n\t\tprops.setQueryListener(props.componentId, props.onQueryChange, null);\n\t}\n\n\tcomponentWillMount() {\n\t\tthis.props.addComponent(this.props.componentId);\n\t\tthis.setReact(this.props);\n\n\t\tif (this.props.selectedValue) {\n\t\t\tthis.selectItem(this.props.selectedValue, true);\n\t\t} else if (this.props.defaultSelected) {\n\t\t\tthis.selectItem(this.props.defaultSelected, true);\n\t\t}\n\t}\n\n\tcomponentWillReceiveProps(nextProps) {\n\t\tcheckPropChange(\n\t\t\tthis.props.react,\n\t\t\tnextProps.react,\n\t\t\t() => this.setReact(nextProps),\n\t\t);\n\n\t\tcheckPropChange(this.props.dataField, nextProps.dataField, () => {\n\t\t\tthis.updateQuery(this.state.currentValue, nextProps);\n\t\t});\n\n\t\tif (!isEqual(this.props.defaultSelected, nextProps.defaultSelected)) {\n\t\t\tthis.selectItem(nextProps.defaultSelected, true);\n\t\t} else if (!isEqual(this.state.currentValue, nextProps.selectedValue)\n\t\t\t&& (nextProps.selectedValue || nextProps.selectedValue === null)) {\n\t\t\tthis.selectItem(nextProps.selectedValue, true);\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.props.removeComponent(this.props.componentId);\n\t}\n\n\tsetReact(props) {\n\t\tif (props.react) {\n\t\t\tprops.watchComponent(props.componentId, props.react);\n\t\t}\n\t}\n\n\t// parses range label to get start and end\n\tstatic parseValue = (value, props) => (value\n\t\t? props.data.filter(item => value.includes(item.label))\n\t\t: null)\n\n\tstatic defaultQuery = (values, props) => {\n\t\tconst generateRangeQuery = (dataField, items) => {\n\t\t\tif (items.length > 0) {\n\t\t\t\treturn items.map(value => ({\n\t\t\t\t\trange: {\n\t\t\t\t\t\t[dataField]: {\n\t\t\t\t\t\t\tgte: value.start,\n\t\t\t\t\t\t\tlte: value.end,\n\t\t\t\t\t\t\tboost: 2.0,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}));\n\t\t\t}\n\t\t\treturn null;\n\t\t};\n\n\t\tif (values && values.length) {\n\t\t\tconst query = {\n\t\t\t\tbool: {\n\t\t\t\t\tshould: generateRangeQuery(props.dataField, values),\n\t\t\t\t\tminimum_should_match: 1,\n\t\t\t\t\tboost: 1.0,\n\t\t\t\t},\n\t\t\t};\n\t\t\treturn query;\n\t\t}\n\t\treturn null;\n\t};\n\n\tselectItem = (item, isDefaultValue = false, props = this.props) => {\n\t\t// ignore state updates when component is locked\n\t\tif (props.beforeValueChange && this.locked) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.locked = true;\n\t\tlet { currentValue } = this.state;\n\n\t\tif (!item) {\n\t\t\tcurrentValue = [];\n\t\t\tthis.selectedValues = {};\n\t\t} else if (isDefaultValue) {\n\t\t\t// checking if the items in defaultSeleted exist in the data prop\n\t\t\tcurrentValue = MultiDropdownRange.parseValue(item, props);\n\t\t\tcurrentValue.forEach((value) => {\n\t\t\t\tthis.selectedValues = { ...this.selectedValues, [value.label]: true };\n\t\t\t});\n\t\t} else if (this.selectedValues[item.label]) {\n\t\t\tcurrentValue = currentValue.filter(value => value.label !== item.label);\n\t\t\tconst { [item.label]: del, ...selectedValues } = this.selectedValues;\n\t\t\tthis.selectedValues = selectedValues;\n\t\t} else {\n\t\t\tcurrentValue = [...currentValue, item];\n\t\t\tthis.selectedValues = { ...this.selectedValues, [item.label]: true };\n\t\t}\n\t\tconst performUpdate = () => {\n\t\t\tthis.setState({\n\t\t\t\tcurrentValue,\n\t\t\t}, () => {\n\t\t\t\tthis.updateQuery(currentValue, props);\n\t\t\t\tthis.locked = false;\n\t\t\t\tif (props.onValueChange) props.onValueChange(currentValue);\n\t\t\t});\n\t\t};\n\n\t\tcheckValueChange(\n\t\t\tprops.componentId,\n\t\t\tcurrentValue,\n\t\t\tprops.beforeValueChange,\n\t\t\tperformUpdate,\n\t\t);\n\t};\n\n\tupdateQuery = (value, props) => {\n\t\tconst query = props.customQuery || MultiDropdownRange.defaultQuery;\n\n\t\tprops.updateQuery({\n\t\t\tcomponentId: props.componentId,\n\t\t\tquery: query(value, props),\n\t\t\tvalue,\n\t\t\tlabel: props.filterLabel,\n\t\t\tshowFilter: props.showFilter,\n\t\t\tURLParams: props.URLParams,\n\t\t});\n\t};\n\n\trender() {\n\t\treturn (\n\t\t\t<Container style={this.props.style} className={this.props.className}>\n\t\t\t\t{this.props.title && <Title className={getClassName(this.props.innerClass, 'title') || null}>{this.props.title}</Title>}\n\t\t\t\t<Dropdown\n\t\t\t\t\tinnerClass={this.props.innerClass}\n\t\t\t\t\titems={this.props.data}\n\t\t\t\t\tonChange={this.selectItem}\n\t\t\t\t\tselectedItem={this.state.currentValue}\n\t\t\t\t\tplaceholder={this.props.placeholder}\n\t\t\t\t\tkeyField=\"label\"\n\t\t\t\t\tmulti\n\t\t\t\t\treturnsObject\n\t\t\t\t\tthemePreset={this.props.themePreset}\n\t\t\t\t/>\n\t\t\t</Container>\n\t\t);\n\t}\n}\n\nMultiDropdownRange.propTypes = {\n\taddComponent: types.funcRequired,\n\tremoveComponent: types.funcRequired,\n\tsetQueryListener: types.funcRequired,\n\tupdateQuery: types.funcRequired,\n\twatchComponent: types.funcRequired,\n\tselectedValue: types.selectedValue,\n\t// component props\n\tbeforeValueChange: types.func,\n\tclassName: types.string,\n\tcomponentId: types.stringRequired,\n\tcustomQuery: types.func,\n\tdata: types.data,\n\tdataField: types.stringRequired,\n\tdefaultSelected: types.stringArray,\n\tfilterLabel: types.filterLabel,\n\tinnerClass: types.style,\n\tonQueryChange: types.func,\n\tonValueChange: types.func,\n\tplaceholder: types.string,\n\treact: types.react,\n\tshowFilter: types.bool,\n\tstyle: types.style,\n\ttitle: types.title,\n\tthemePreset: types.themePreset,\n\tURLParams: types.bool,\n};\n\nMultiDropdownRange.defaultProps = {\n\tclassName: null,\n\tplaceholder: 'Select a value',\n\tshowFilter: true,\n\tstyle: {},\n\tURLParams: false,\n};\n\nconst mapStateToProps = (state, props) => ({\n\tselectedValue: state.selectedValues[props.componentId]\n\t\t? state.selectedValues[props.componentId].value\n\t\t: null,\n\tthemePreset: state.config.themePreset,\n});\n\nconst mapDispatchtoProps = dispatch => ({\n\taddComponent: component => dispatch(addComponent(component)),\n\tremoveComponent: component => dispatch(removeComponent(component)),\n\tupdateQuery: updateQueryObject => dispatch(updateQuery(updateQueryObject)),\n\twatchComponent: (component, react) => dispatch(watchComponent(component, react)),\n\tsetQueryListener: (component, onQueryChange, beforeQueryChange) =>\n\t\tdispatch(setQueryListener(component, onQueryChange, beforeQueryChange)),\n});\n\nexport default connect(mapStateToProps, mapDispatchtoProps)(MultiDropdownRange);\n"]}